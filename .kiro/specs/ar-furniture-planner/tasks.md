# 実装計画

- [x] 1. プロジェクト基盤とAR初期設定
  - Xcodeプロジェクトの設定とARKit/RealityKitの統合
  - カメラ許可とARSession基本実装
  - _要件: 1.1, 1.2, 1.3_

- [x] 1.1 Xcodeプロジェクト設定とフレームワーク統合
  - ARKit、RealityKit、SwiftUIフレームワークをインポート
  - Info.plistにカメラ使用許可（NSCameraUsageDescription）を追加
  - ARKit対応デバイスの要件設定
  - _要件: 1.1, 1.4_

- [x] 1.2 ARViewManagerクラスの基本実装
  - ARViewManagerクラスを作成し、ObservableObjectプロトコルに準拠
  - ARSessionの初期化、開始、停止メソッドを実装
  - ARWorldTrackingConfigurationの設定
  - _要件: 1.1, 1.2_

- [x] 1.3 SwiftUIとARViewの統合
  - ARViewをSwiftUIに統合するためのUIViewRepresentableを実装
  - ContentViewでARViewを表示
  - ARSessionの状態管理とライフサイクル処理
  - _要件: 1.1_

- [ ]* 1.4 基本AR機能の単体テスト
  - ARViewManagerの初期化テスト
  - ARSession開始/停止のテスト
  - カメラ許可処理のテスト
  - _要件: 1.1, 1.4_

- [x] 2. 平面検出とビジュアル表示
  - 水平面検出の実装と検出された平面の可視化
  - 平面検出状態のUI表示
  - _要件: 1.2, 1.3, 1.5_

- [x] 2.1 水平面検出機能の実装
  - ARWorldTrackingConfigurationで水平面検出を有効化
  - ARSessionDelegateを実装してanchor追加/更新を処理
  - 検出された平面のARPlaneAnchorを管理
  - _要件: 1.2_

- [x] 2.2 平面の可視化システム
  - 検出された平面にメッシュエンティティを生成
  - 平面の境界を視覚的に表示（デバッグモード用）
  - 平面の表示/非表示切り替え機能
  - _要件: 1.3_

- [x] 2.3 平面検出状態のUI実装
  - 平面検出の進行状況を示すインジケーター
  - 検出失敗時のガイダンスメッセージ表示
  - 照明不足時の改善提案UI
  - _要件: 1.5, 8.2_

- [ ]* 2.4 平面検出機能の統合テスト
  - 平面検出の精度テスト
  - UI状態更新のテスト
  - エラーハンドリングのテスト
  - _要件: 1.2, 1.3, 1.5_

- [x] 3. 基本的な3Dモデル配置システム
  - シンプルなテストモデルの配置機能
  - タップによる配置とスナップ機能
  - _要件: 2.1, 2.2, 2.3_

- [x] 3.1 FurnitureModelデータ構造の実装
  - FurnitureModel構造体の定義（ID、名前、カテゴリ、ファイル名、実寸法）
  - モデルメタデータのJSONファイル作成
  - モデル読み込み機能の実装
  - _要件: 5.1, 5.4_

- [x] 3.2 テスト用3Dモデルの準備
  - Reality Composerでシンプルな立方体・球体モデルを作成
  - USDZフォーマットでエクスポート
  - プロジェクトにモデルファイルを追加
  - _要件: 2.5_

- [x] 3.3 タップによるモデル配置機能
  - 画面タップの検出とAR座標への変換
  - 検出された平面上への配置ロジック
  - ModelEntityの生成と ARView への追加
  - _要件: 2.1, 2.2_

- [x] 3.4 自動スナップと影の生成
  - モデルを床面に自動的にスナップする機能
  - RealityKitでリアルな影を生成
  - 配置時のアニメーション効果
  - _要件: 2.2, 2.3_

- [ ]* 3.5 基本配置機能の統合テスト
  - タップ位置とモデル配置位置の精度テスト
  - 影の表示確認テスト
  - 複数回配置のテスト
  - _要件: 2.1, 2.2, 2.3_

- [x] 4. ジェスチャーベースのモデル操作
  - ドラッグ、ピンチ、回転ジェスチャーの実装
  - モデル選択とハイライト表示
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 4.1 PlacedFurnitureEntityクラスの実装
  - Entity、HasModel、HasCollisionプロトコルに準拠したクラス作成
  - 選択状態の管理（isSelectedプロパティ）
  - ハイライト表示機能（選択時の視覚的フィードバック）
  - _要件: 3.1, 3.5_

- [x] 4.2 RealityKitジェスチャーシステムの統合
  - installGestures()を使用してドラッグ、ピンチ、回転を有効化
  - ジェスチャーの制約設定（垂直移動制限、Y軸回転のみ、スケール制限）
  - 複数ジェスチャーの競合回避
  - _要件: 3.2, 3.3, 3.4_

- [x] 4.3 モデル選択システムの実装
  - タップによるモデル選択機能
  - 選択中モデルのハイライト表示
  - 他の場所タップによる選択解除
  - _要件: 3.1, 3.5_

- [x] 4.4 パフォーマンス最適化
  - ジェスチャー処理中の30+ FPS維持
  - 操作レスポンスの最適化
  - メモリ使用量の監視
  - _要件: 3.6, 7.1_

- [ ]* 4.5 ジェスチャー操作の統合テスト
  - 各ジェスチャーの動作確認テスト
  - ジェスチャー競合のテスト
  - パフォーマンス測定テスト
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [x] 5. 複数モデル管理システム
  - 複数家具の同時配置と個別操作
  - 削除機能とリセット機能
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 5.1 モデル管理システムの実装
  - 配置済みモデルの配列管理
  - 各モデルへの一意ID付与システム
  - モデル追加・削除・検索機能
  - _要件: 4.1, 4.2_

- [x] 5.2 個別モデル操作機能
  - 複数モデル中の特定モデル選択
  - 選択されたモデルの個別操作
  - モデル間の操作干渉防止
  - _要件: 4.1, 4.5_

- [x] 5.3 削除機能の実装
  - 選択中モデルの削除機能
  - 削除確認UI（オプション）
  - 全モデル削除（リセット）機能
  - _要件: 4.2, 4.3_

- [x] 5.4 パフォーマンス管理
  - 最大10個モデルでの安定動作
  - メモリ使用量の最適化
  - レンダリングパフォーマンスの維持
  - _要件: 4.4, 7.1, 7.3_

- [ ]* 5.5 複数モデル管理の統合テスト
  - 複数モデル配置のテスト
  - 個別操作の精度テスト
  - パフォーマンス負荷テスト
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 6. 実寸サイズシステムの実装
  - 正確な実世界スケールでのモデル表示
  - メタデータベースのサイズ管理
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 6.1 スケール計算システムの実装
  - ARKitの1単位=1メートル標準に基づくスケール計算
  - モデルのバウンディングボックス計算
  - 実寸法からスケール係数への変換
  - _要件: 5.2, 5.3_

- [ ] 6.2 メタデータ管理システム
  - 家具メタデータのJSONファイル構造設計
  - モデルIDと実寸法の紐付けシステム
  - デフォルト寸法とエラーハンドリング
  - _要件: 5.1, 5.5_

- [ ] 6.3 自動スケール適用機能
  - モデル読み込み時の自動スケール適用
  - スケール精度の検証機能
  - 異なるサイズモデルでの一貫性確保
  - _要件: 5.1, 5.3, 5.4_

- [ ]* 6.4 サイズ精度の検証テスト
  - 実寸法の正確性テスト
  - 様々なサイズモデルでの動作テスト
  - スケール計算の精度テスト
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ] 7. 家具カタログUIシステム
  - 複数家具の選択UI実装
  - カテゴリ分類とサムネイル表示
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 7.1 FurnitureRepositoryクラスの実装
  - 家具データベースの読み込み機能
  - モデルキャッシュシステム
  - カテゴリ別の家具管理
  - _要件: 6.2, 6.4_

- [ ] 7.2 家具選択UIの実装
  - 画面下部のカルーセルまたはグリッドUI
  - サムネイル画像とモデル名の表示
  - 現在選択中の家具の視覚的表示
  - _要件: 6.1, 6.2, 6.5_

- [ ] 7.3 カテゴリフィルター機能
  - 家具カテゴリ（ソファ、テーブル、椅子など）の分類
  - カテゴリ別フィルタリング機能
  - カテゴリ切り替えのスムーズな遷移
  - _要件: 6.4, 6.5_

- [ ] 7.4 家具切り替えシステム
  - UIからの家具選択と配置モードの切り替え
  - 選択状態の管理と視覚的フィードバック
  - 家具変更時のスムーズなアニメーション
  - _要件: 6.3, 6.5_

- [ ]* 7.5 家具カタログUIの統合テスト
  - UI操作の直感性テスト
  - 家具切り替えのスムーズさテスト
  - サムネイル表示の確認テスト
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 8. ユーザーガイダンスとエラーハンドリング
  - 初回チュートリアルとヘルプシステム
  - エラー状況での適切なガイダンス
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 8.1 チュートリアルシステムの実装
  - 初回起動時のインタラクティブチュートリアル
  - 操作ガイドのオーバーレイ表示
  - チュートリアルスキップ機能
  - _要件: 8.1_

- [ ] 8.2 エラーハンドリングシステム
  - ARFurnitureErrorエラータイプの定義
  - ユーザーフレンドリーなエラーメッセージ
  - エラー状況に応じた回復ガイダンス
  - _要件: 8.2, 8.3, 8.4, 8.5_

- [ ] 8.3 状態監視とフィードバック
  - ARトラッキング状態の監視
  - 平面検出進行状況の表示
  - パフォーマンス低下時の自動調整
  - _要件: 8.4, 7.5_

- [ ]* 8.4 ユーザーエクスペリエンスのテスト
  - チュートリアルの分かりやすさテスト
  - エラーメッセージの適切性テスト
  - 全体的なユーザビリティテスト
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 9. 最終統合とパフォーマンス最適化
  - 全機能の統合とパフォーマンス調整
  - 実機テストと最終調整
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 9.1 パフォーマンス最適化の実装
  - LOD（詳細レベル）システムの実装
  - 未使用リソースの自動解放
  - フレームレート維持のための品質調整
  - _要件: 7.1, 7.3, 7.5_

- [ ] 9.2 メモリ管理の最適化
  - モデルキャッシュのLRU管理
  - メモリリーク検出と修正
  - 長時間使用での安定性確保
  - _要件: 7.3, 7.4_

- [ ] 9.3 実機テストと調整
  - 様々なiOSデバイスでの動作確認
  - パフォーマンス測定と調整
  - ユーザビリティの最終確認
  - _要件: 7.1, 7.2_

- [ ]* 9.4 最終統合テスト
  - 全機能の統合動作テスト
  - パフォーマンス要件の最終確認
  - リリース準備の完了確認
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_