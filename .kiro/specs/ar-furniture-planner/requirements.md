# 要件定義書

## 概要

本文書は、拡張現実（AR）技術を使用して実世界の空間に3D家具モデルを可視化・配置するiOSアプリケーション「AR家具プランナー」の要件を定義します。このアプリは、ユーザーが空き部屋で家具の配置をシミュレーションし、家具購入や部屋のレイアウトに関する情報に基づいた決定を支援します。

## 要件

### 要件1: AR空間認識

**ユーザーストーリー:** ユーザーとして、アプリが自動的に部屋の表面を検出・認識することで、適切な表面に家具を配置したい。

#### 受入基準

1. アプリが起動したとき、システムはカメラ許可を要求し、ARKitを初期化すること
2. カメラがアクティブなとき、システムは水平面（床）を継続的に検出すること
3. 水平面が検出されたとき、システムは検出された表面を視覚的に示すこと
4. デバイスがARKitをサポートしていない場合、システムは適切なエラーメッセージを表示すること
5. 照明条件が不十分なとき、システムは検出を改善するためのガイダンスを提供すること

### 要件2: 3Dモデル配置

**ユーザーストーリー:** ユーザーとして、検出された表面をタップして3D家具モデルを部屋に配置し、家具が空間でどのように見えるかを可視化したい。

#### 受入基準

1. 検出された平面をタップしたとき、システムは現在選択されている家具モデルをその位置に配置すること
2. モデルが配置されたとき、システムは自動的に検出された床面にスナップすること
3. モデルが配置されたとき、システムはモデルの下にリアルな影を生成すること
4. 複数のモデルが配置されたとき、システムはARシーン内ですべてのモデルを同時に維持すること
5. モデルが配置されたとき、システムは正確な実世界スケールで表示されることを保証すること

### 要件3: ジェスチャーベースのモデル操作

**ユーザーストーリー:** ユーザーとして、タッチジェスチャーを使用して配置された家具を移動、リサイズ、回転させ、配置と向きを好みに調整したい。

#### 受入基準

1. 配置されたモデルをタップしたとき、システムはそのモデルを選択してハイライト表示すること
2. 選択されたモデルをドラッグしたとき、システムは検出された平面表面上でのみ移動させること
3. 選択されたモデルでピンチジェスチャーを使用したとき、システムは合理的な制限内でモデルをスケールすること
4. 選択されたモデルで2本指回転を使用したとき、システムはY軸周りでのみ回転させること
5. 他の場所をタップしたとき、システムは現在選択されているモデルの選択を解除すること
6. モデルを操作するとき、システムは滑らかな30+ FPSのパフォーマンスを維持すること

### 要件4: 複数モデル管理

**ユーザーストーリー:** ユーザーとして、複数の家具を配置して個別に管理し、完全な部屋のレイアウトを作成したい。

#### 受入基準

1. 複数のモデルを配置したとき、システムは各モデルを独立して選択・操作できること
2. モデルを選択したとき、システムはその特定のモデルの削除オプションを提供すること
3. リセットを選択したとき、システムはシーンからすべての配置されたモデルを削除すること
4. 複数のモデルを管理するとき、システムは最大10個のモデルで安定したパフォーマンスを維持すること
5. モデルが互いに近くに配置されたとき、システムは干渉なしに正確な選択を可能にすること

### 要件5: 実世界サイズの精度

**ユーザーストーリー:** ユーザーとして、家具モデルが実際の実世界の寸法で表示されることで、空間に収まるかどうかを正確に評価したい。

#### 受入基準

1. モデルが読み込まれたとき、システムはメタデータから正確な実世界の寸法を適用すること
2. スケールを計算するとき、システムはARKitの1単位=1メートル標準を使用すること
3. モデルが配置されたとき、システムはスケールが指定された実世界の寸法と一致することを検証すること
4. モデルを表示するとき、システムはすべての家具タイプで一貫したスケーリングを維持すること
5. モデルメタデータが欠落している場合、システムはデフォルトの寸法を使用し、警告をログに記録すること

### 要件6: 家具カタログインターフェース

**ユーザーストーリー:** ユーザーとして、複数の家具オプションを閲覧・選択し、空間で異なる家具を試したい。

#### 受入基準

1. アプリが読み込まれたとき、システムは画面下部に家具選択インターフェースを表示すること
2. 家具を閲覧するとき、システムは各アイテムのサムネイル画像と名前を表示すること
3. 家具アイテムを選択したとき、システムはそれを配置用のアクティブモデルとして設定すること
4. カテゴリを閲覧するとき、システムは家具をタイプ別（ソファ、テーブル、椅子など）に整理すること
5. 家具を切り替えるとき、システムは滑らかな遷移と明確な視覚的フィードバックを提供すること

### 要件7: パフォーマンスと安定性

**ユーザーストーリー:** ユーザーとして、アプリがクラッシュやラグなしにデバイス上で滑らかに動作し、シームレスなAR体験を得たい。

#### 受入基準

1. アプリを使用するとき、システムはARレンダリング中に少なくとも30 FPSを維持すること
2. 3Dモデルを読み込むとき、システムは10MB未満のモデルを3秒以内に読み込み完了すること
3. メモリ使用量が増加したとき、システムは未使用のリソースを自動的に解放すること
4. アプリが長時間実行されるとき、システムはメモリリークなしに安定を保つこと
5. パフォーマンスが低下した場合、システムはフレームレートを維持するために品質設定を自動的に下げること

### 要件8: ユーザーガイダンスとエラーハンドリング

**ユーザーストーリー:** ユーザーとして、明確なガイダンスと有用なエラーメッセージにより、問題に遭遇してもAR機能を正常に使用したい。

#### 受入基準

1. 初回起動時、システムはインタラクティブなチュートリアルを提供すること
2. 平面検出が失敗したとき、システムは検出を改善するための有用なヒントを表示すること
3. カメラアクセスが拒否されたとき、システムはカメラアクセスが必要な理由と有効化方法を説明すること
4. ARトラッキングが失われたとき、システムはユーザーに通知し、回復ガイダンスを提供すること
5. エラーが発生したとき、システムは技術的なエラーコードではなく、ユーザーフレンドリーなメッセージを表示すること